<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Aquaris AI - Species Identifier</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Inter', sans-serif; background-color: #0d0d0d; }
    .container { max-width: 800px; margin: auto; padding-top: 5rem; }
    .card { background-color: #1a1a1a; border: 1px solid #333; box-shadow: 0 4px 10px rgba(0,0,0,0.4); }
    ::-webkit-scrollbar { width: 8px; }
    ::-webkit-scrollbar-track { background: #1a1a1a; }
    ::-webkit-scrollbar-thumb { background: #06b6d4; border-radius: 10px; }
  </style>
</head>
<body class="bg-gray-900 text-white min-h-screen">

<header class="fixed top-0 left-0 w-full bg-gray-900 bg-opacity-90 backdrop-blur-sm z-50">
  <div class="container mx-auto px-4 py-3 flex justify-start items-center max-w-7xl">
    <a href="index.html" class="p-2 rounded-full hover:bg-gray-700 transition">
      <svg class="w-6 h-6 text-cyan-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
      </svg>
    </a>
  </div>
</header>

<main class="container mx-auto px-4 py-8">
  <h1 class="text-3xl sm:text-4xl font-extrabold text-center text-cyan-400 mb-10 mt-12">AI Species Identifier</h1>

  <div class="card p-6 rounded-xl space-y-6 mb-8">
    <h2 class="text-2xl font-semibold border-b border-gray-700 pb-2">1. Upload Image</h2>
    <label for="imageUpload" class="block text-lg font-medium text-gray-300">Select a clear image of the fish (JPG/PNG)</label>
    <input type="file" id="imageUpload" accept="image/jpeg, image/png" class="w-full text-white bg-gray-700 border border-gray-600 rounded-lg p-3 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-cyan-600 file:text-white hover:file:bg-cyan-500 cursor-pointer">

    <div class="mt-4 border border-gray-700 rounded-lg overflow-hidden">
      <img id="imagePreview" src="#" alt="Image Preview" class="max-w-full h-auto mx-auto block" style="display:none; max-height:300px; object-fit:contain;">
      <p id="previewPlaceholder" class="text-center text-gray-500 py-10">Image preview will appear here.</p>
    </div>
  </div>

  <button id="predictBtn" class="w-full bg-cyan-600 text-white text-xl font-bold py-4 rounded-xl hover:bg-cyan-500 transition shadow-lg shadow-cyan-900/50 mb-8 disabled:bg-gray-600 disabled:cursor-not-allowed">Identify Species üé£</button>
  <p id="statusMessage" class="text-center font-medium mb-4"></p>

  <div id="results" class="card p-6 rounded-xl space-y-4" style="display:none;">
    <h2 class="text-2xl font-semibold border-b border-gray-700 pb-2 text-cyan-400">2. Prediction Report</h2>
    <div id="predictionStatusContainer" class="p-4 rounded-lg">
      <p id="predictedClass" class="text-2xl font-bold"></p>
      <p id="confidenceLevel" class="text-gray-400 mt-2"></p>
    </div>
    <div id="confidenceDetail" class="pt-4 border-t border-gray-700 text-sm text-gray-500">
      <p>Note: Prediction is based on a trained model of 11 specific species. A confidence below the threshold is flagged as 'Invasive Species'.</p>
    </div>
  </div>
</main>

<footer class="py-8 bg-gray-900 text-center text-gray-500 border-t border-gray-700 mt-10">
  <p>&copy; 2025 Aquaris AI. All rights reserved.</p>
</footer>

<script>
  const API_ENDPOINT = 'http://127.0.0.1:5000/api/predict_species'; 
  const PREDICTION_THRESHOLD = 50;

  const imageUpload = document.getElementById('imageUpload');
  const imagePreview = document.getElementById('imagePreview');
  const previewPlaceholder = document.getElementById('previewPlaceholder');
  const predictBtn = document.getElementById('predictBtn');
  const statusMessage = document.getElementById('statusMessage');
  const resultsDiv = document.getElementById('results');
  const predictionStatusContainer = document.getElementById('predictionStatusContainer');
  const predictedClass = document.getElementById('predictedClass');
  const confidenceLevel = document.getElementById('confidenceLevel');

  // --- Preview Image ---
  imageUpload.addEventListener('change', function(event) {
    const file = event.target.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = function(e) {
        imagePreview.src = e.target.result;
        imagePreview.style.display = 'block';
        previewPlaceholder.style.display = 'none';
      };
      reader.readAsDataURL(file);
    } else {
      imagePreview.style.display = 'none';
      previewPlaceholder.style.display = 'block';
    }
  });

  function fileToBase64(file) {
    return new Promise((resolve, reject) => {
      const reader = new FileReader();
      reader.onload = () => resolve(reader.result);
      reader.onerror = error => reject(error);
      reader.readAsDataURL(file);
    });
  }

  // --- Predict ---
  predictBtn.addEventListener('click', async () => {
    const imageFile = imageUpload.files[0];
    statusMessage.textContent = '';
    resultsDiv.style.display = 'none';
    predictBtn.disabled = true;

    if (!imageFile) {
      statusMessage.textContent = 'Please upload a fish image first.';
      statusMessage.className = 'text-red-500';
      predictBtn.disabled = false;
      return;
    }

    statusMessage.textContent = 'Analyzing image...';
    statusMessage.className = 'text-cyan-400';

    try {
      const base64Data = await fileToBase64(imageFile);
      const requestData = { image_data: base64Data, threshold: PREDICTION_THRESHOLD };
      const response = await fetch(API_ENDPOINT, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(requestData)
      });

      const result = await response.json();
      if (response.ok) {
        displayResults(result);
        statusMessage.textContent = 'Identification complete!';
        statusMessage.className = 'text-green-500';
      } else {
        statusMessage.textContent = `Error: ${result.error || 'API call failed'}`;
        statusMessage.className = 'text-red-500';
      }
    } catch (error) {
      console.error('Fetch error:', error);
      statusMessage.textContent = 'A network error occurred. Check if the Flask server is running.';
      statusMessage.className = 'text-red-500';
    } finally {
      predictBtn.disabled = false;
    }
  });

  function displayResults(result) {
    resultsDiv.style.display = 'block';
    const confidence = result.confidence;
    const species = result.predicted_class;

    predictedClass.textContent = species;
    confidenceLevel.textContent = `Confidence: ${confidence.toFixed(2)}%`;

    if (species === "Invasive Species") { 
      predictionStatusContainer.className = 'p-4 rounded-lg bg-yellow-900/50 border border-yellow-700';
      predictedClass.innerHTML = `‚ö†Ô∏è <span class="text-yellow-400">Invasive Species</span> Detected?`;
      confidenceLevel.textContent = `(Confidence was ${confidence.toFixed(2)}%, below the ${PREDICTION_THRESHOLD}% threshold)`;
    } else {
      predictionStatusContainer.className = 'p-4 rounded-lg bg-green-900/50 border border-green-700';
      predictedClass.innerHTML = `‚úÖ Identified as: <span class="text-cyan-400">${species}</span>`;
    }
  }
</script>
</body>
</html>
