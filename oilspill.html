<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aquaris AI - Oil Spill Detection</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { 
            font-family: 'Inter', sans-serif; 
            background-color: #0d0d0d;
        }
        .container { 
            max-width: 1000px; 
            margin: auto; 
            padding-top: 5rem; /* Space for the fixed header */
        }
        .card {
            background-color: #1a1a1a;
            border: 1px solid #333;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.4);
        }
        /* Custom scrollbar to match dark theme */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #1a1a1a; }
        ::-webkit-scrollbar-thumb { background: #06b6d4; border-radius: 10px; }
    </style>
</head>
<body class="bg-gray-900 text-white min-h-screen">

    <header class="fixed top-0 left-0 w-full bg-gray-900 bg-opacity-90 backdrop-blur-sm z-50">
        <div class="container mx-auto px-4 py-3 flex justify-start items-center max-w-7xl">
            <a href="index.html" title="Back to Main Page"
               class="p-2 rounded-full hover:bg-gray-700 transition">
                <svg class="w-6 h-6 text-cyan-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
                </svg>
            </a>
        </div>
    </header>

    <main class="container mx-auto px-4 py-8">
        <h1 class="text-3xl sm:text-4xl font-extrabold text-center text-cyan-400 mb-10 mt-12">
            Oil Spill Detection & Dispersion Forecast
        </h1>

        <div class="grid lg:grid-cols-2 gap-8 mb-10">
            <div class="card p-6 rounded-xl space-y-4">
                <h2 class="text-2xl font-semibold mb-4 border-b border-gray-700 pb-2">1. Image Input</h2>
                <label for="imageUpload" class="block text-lg font-medium text-gray-300">
                    Upload Ocean Image (JPG/PNG)
                </label>
                <input type="file" id="imageUpload" accept="image/jpeg, image/png" 
                       class="w-full text-white bg-gray-700 border border-gray-600 rounded-lg p-3 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-cyan-600 file:text-white hover:file:bg-cyan-500 cursor-pointer">
                
                <div class="mt-4 border border-gray-700 rounded-lg overflow-hidden">
                    <img id="imagePreview" src="#" alt="Image Preview" 
                         class="max-w-full h-auto mx-auto block" style="display: none; max-height: 300px; object-fit: contain;">
                    <p id="previewPlaceholder" class="text-center text-gray-500 py-10" style="display: block;">Image preview will appear here.</p>
                </div>
            </div>

            <div class="card p-6 rounded-xl space-y-4">
                <h2 class="text-2xl font-semibold mb-4 border-b border-gray-700 pb-2">2. Environmental Factors</h2>
                
                <p class="text-gray-400">
                    Enter the three key environmental factors for dispersion forecasting.
                </p>

                <div>
                    <label for="windSpeed" class="block text-sm font-medium text-gray-400">Wind Speed (m/s)</label>
                    <input type="number" id="windSpeed" value="5.0" step="0.1" min="0" 
                           class="w-full p-2 mt-1 bg-gray-700 border border-gray-600 rounded-lg text-white focus:ring-cyan-500 focus:border-cyan-500">
                </div>
                
                <div>
                    <label for="wavePeriod" class="block text-sm font-medium text-gray-400">Wave Speed (m/s)</label>
                    <input type="number" id="wavePeriod" value="6.0" step="0.1" min="0" 
                           class="w-full p-2 mt-1 bg-gray-700 border border-gray-600 rounded-lg text-white focus:ring-cyan-500 focus:border-cyan-500">
                </div>
                
                <div>
                    <label for="latitude" class="block text-sm font-medium text-gray-400">Latitude (deg)</label>
                    <input type="number" id="latitude" value="10.0" step="1" min="0" max="90" 
                           class="w-full p-2 mt-1 bg-gray-700 border border-gray-600 rounded-lg text-white focus:ring-cyan-500 focus:border-cyan-500">
                </div>
                
            </div>
        </div>
        
        <button id="predictBtn" 
                class="w-full bg-cyan-600 text-white text-xl font-bold py-4 rounded-xl hover:bg-cyan-500 transition shadow-lg shadow-cyan-900/50 mb-8 disabled:bg-gray-600 disabled:cursor-not-allowed">
            Run Oil Spill Analysis & Forecast ğŸ”
        </button>
        <p id="statusMessage" class="text-center font-medium mb-4"></p>

        <div id="results" class="card p-6 rounded-xl space-y-4" style="display: none;">
            <h2 class="text-2xl font-semibold border-b border-gray-700 pb-2 text-cyan-400">3. Analysis Report</h2>
            
            <div id="detectionStatusContainer" class="p-4 rounded-lg">
                <p id="detectionStatus" class="text-xl font-bold"></p>
                <p id="envSummary" class="text-gray-400 mt-1"></p>
            </div>
            
            <div id="forecastContainer" class="pt-4 border-t border-gray-700" style="display: none;">
                <h3 class="text-xl font-semibold mb-3">Dispersion Forecast</h3>
                <p class="text-sm text-gray-400 mb-4">
                    Projected growth of the oil slick over the next week based on current factors.
                </p>
                
                <p class="mb-4">Area Growth: <span id="growthSummary" class="font-bold text-cyan-400"></span></p>

                <div class="overflow-x-auto">
                    <table class="w-full text-sm text-left text-gray-300 rounded-lg overflow-hidden">
                        <thead class="text-xs text-white uppercase bg-gray-700">
                            <tr>
                                <th scope="col" class="py-3 px-6">Day</th>
                                <th scope="col" class="py-3 px-6">Total Area ($km^2$)</th>
                            </tr>
                        </thead>
                        <tbody id="forecastTableBody">
                            </tbody>
                    </table>
                </div>
            </div>
        </div>
    </main>



    <script>
Â  Â  Â  Â  const API_ENDPOINT = 'https://aquarisai-production.up.railway.app/api/analyze_spill';

Â  Â  Â  Â  // Get DOM Elements
Â  Â  Â  Â  const imageUpload = document.getElementById('imageUpload');
Â  Â  Â  Â  const imagePreview = document.getElementById('imagePreview');
Â  Â  Â  Â  const previewPlaceholder = document.getElementById('previewPlaceholder');
Â  Â  Â  Â  const predictBtn = document.getElementById('predictBtn');
Â  Â  Â  Â  const statusMessage = document.getElementById('statusMessage');
Â  Â  Â  Â  const resultsDiv = document.getElementById('results');
Â  Â  Â  Â  const detectionStatusContainer = document.getElementById('detectionStatusContainer');
Â  Â  Â  Â  const detectionStatus = document.getElementById('detectionStatus');
Â  Â  Â  Â  const envSummary = document.getElementById('envSummary');
Â  Â  Â  Â  const forecastContainer = document.getElementById('forecastContainer');
Â  Â  Â  Â  const forecastTableBody = document.getElementById('forecastTableBody');
Â  Â  Â  Â  const growthSummary = document.getElementById('growthSummary');
        const latitudeInput = document.getElementById('latitude'); // Get the latitude input


Â  Â  Â  Â  // 1. Image Preview and Base64 Conversion
Â  Â  Â  Â  imageUpload.addEventListener('change', function(event) {
Â  Â  Â  Â  Â  Â  const file = event.target.files[0];
Â  Â  Â  Â  Â  Â  if (file) {
Â  Â  Â  Â  Â  Â  Â  Â  imagePreview.src = URL.createObjectURL(file);
Â  Â  Â  Â  Â  Â  Â  Â  imagePreview.style.display = 'block';
Â  Â  Â  Â  Â  Â  Â  Â  previewPlaceholder.style.display = 'none';
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  imagePreview.style.display = 'none';
Â  Â  Â  Â  Â  Â  Â  Â  previewPlaceholder.style.display = 'block';
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });

Â  Â  Â  Â  function fileToBase64(file) {
Â  Â  Â  Â  Â  Â  return new Promise((resolve, reject) => {
Â  Â  Â  Â  Â  Â  Â  Â  const reader = new FileReader();
Â  Â  Â  Â  Â  Â  Â  Â  reader.onload = () => resolve(reader.result); 
Â  Â  Â  Â  Â  Â  Â  Â  reader.onerror = error => reject(error);
Â  Â  Â  Â  Â  Â  Â  Â  reader.readAsDataURL(file);
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }

Â  Â  Â  Â  // 2. Prediction Handler
Â  Â  Â  Â  predictBtn.addEventListener('click', async () => {
Â  Â  Â  Â  Â  Â  const imageFile = imageUpload.files[0];
            const latitudeValue = parseFloat(latitudeInput.value); // Get the current latitude value
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  statusMessage.textContent = '';
Â  Â  Â  Â  Â  Â  resultsDiv.style.display = 'none';
Â  Â  Â  Â  Â  Â  predictBtn.disabled = true;

Â  Â  Â  Â  Â  Â  if (!imageFile) {
Â  Â  Â  Â  Â  Â  Â  Â  statusMessage.textContent = 'Please upload an image first.';
Â  Â  Â  Â  Â  Â  Â  Â  statusMessage.className = 'text-red-500';
Â  Â  Â  Â  Â  Â  Â  Â  predictBtn.disabled = false;
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }

            // --- VALIDATION CHECK FOR LATITUDE ---
            if (latitudeValue < 0) {
                statusMessage.textContent = 'âš ï¸ Latitude must be a positive value between 0 and 90 degrees.';
                statusMessage.className = 'text-red-500';
                predictBtn.disabled = false;
                return;
            }
            // --- END VALIDATION CHECK ---

Â  Â  Â  Â  Â  Â  statusMessage.textContent = 'Processing... Running CNN and Regression Models.';
Â  Â  Â  Â  Â  Â  statusMessage.className = 'text-cyan-400';

Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  const base64Data = await fileToBase64(imageFile); 
Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  const requestData = {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  image_data: base64Data,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Only send the three required fields
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  wind_speed: parseFloat(document.getElementById('windSpeed').value),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Value is from 'wavePeriod' ID which sends the Wave Speed value
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  wave_period: parseFloat(document.getElementById('wavePeriod').value), 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  latitude: latitudeValue,
Â  Â  Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  Â  Â  const response = await fetch(API_ENDPOINT, {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  method: 'POST',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  headers: { 'Content-Type': 'application/json' },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  body: JSON.stringify(requestData)
Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  const result = await response.json();
Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  if (response.ok) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  displayResults(result);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  statusMessage.textContent = 'Analysis complete!';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  statusMessage.className = 'text-green-500';
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  statusMessage.textContent = `Error: ${result.error || 'API call failed'}`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  statusMessage.className = 'text-red-500';
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  Â  Â  console.error('Fetch error:', error);
Â  Â  Â  Â  Â  Â  Â  Â  statusMessage.textContent = 'A network error occurred.';
Â  Â  Â  Â  Â  Â  Â  Â  statusMessage.className = 'text-red-500';
Â  Â  Â  Â  Â  Â  } finally {
Â  Â  Â  Â  Â  Â  Â  Â  predictBtn.disabled = false;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });

Â  Â  Â  Â  // 3. Display Results
Â  Â  Â  Â  function displayResults(result) {
Â  Â  Â  Â  Â  Â  resultsDiv.style.display = 'block';
Â  Â  Â  Â  Â  Â  envSummary.textContent = result.environmental_summary;
Â  Â  Â  Â  Â  Â  forecastTableBody.innerHTML = ''; 
Â  Â  Â  Â  Â  Â  forecastContainer.style.display = 'none';

Â  Â  Â  Â  Â  Â  if (result.oil_detected) {
Â  Â  Â  Â  Â  Â  Â  Â  detectionStatus.innerHTML = `ğŸš¨ OIL SPILL DETECTED! (Confidence: ${result.confidence})`;
Â  Â  Â  Â  Â  Â  Â  Â  detectionStatusContainer.className = 'p-4 rounded-lg bg-red-900/50 border border-red-700';

Â  Â  Â  Â  Â  Â  Â  Â  if (result.dispersion_forecast && result.dispersion_forecast.length > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  forecastContainer.style.display = 'block';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let startArea = result.dispersion_forecast[0].area_km2_total;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let endArea = result.dispersion_forecast[result.dispersion_forecast.length - 1].area_km2_total;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let timeSpan = result.dispersion_forecast[result.dispersion_forecast.length - 1].day;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let rate = (endArea - startArea).toFixed(2);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  growthSummary.textContent = `${startArea} kmÂ² (Day 1) to ${endArea} kmÂ² (Day ${timeSpan}) | Total Growth: +${rate} kmÂ²`;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  result.dispersion_forecast.forEach(item => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const row = forecastTableBody.insertRow();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  row.className = 'border-b border-gray-700 hover:bg-gray-800';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const dayCell = row.insertCell(0);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const areaCell = row.insertCell(1);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dayCell.className = 'py-3 px-6 font-medium text-white';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  areaCell.className = 'py-3 px-6 text-cyan-400';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dayCell.textContent = `Day ${item.day}`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  areaCell.textContent = item.area_km2_total;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  growthSummary.textContent = 'Forecast data unavailable.';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  forecastContainer.style.display = 'block';
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  detectionStatus.innerHTML = `âœ… NO OIL SPILL DETECTED (Confidence: ${(1.0 - result.confidence).toFixed(3)})`;
Â  Â  Â  Â  Â  Â  Â  Â  detectionStatusContainer.className = 'p-4 rounded-lg bg-green-900/50 border border-green-700';
Â  Â  Â  Â  Â  Â  Â  Â  forecastContainer.style.display = 'none';
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
</script>
</body>
</html>